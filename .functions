#!/usr/bin/env bash

ftrim() {
  case "${1}" in 
    -h|--help)
      echo "Usage: ftrim [-b|-e] <bytes> <file>"
      echo "Remove N bytes from the beginning or end of the file"
      echo " "
      echo "options: "
      echo "-b, --begin       Remove bytes from the beginning"
      echo "-e, --end         Remove bytes from the end"
      ;;
    -b|--begin)
      bytes=$(($(/usr/bin/stat -f '%z' "${3}") - ${2}))
      tail -c ${bytes} "${3}"
      ;;
    -e|--end)
      bytes=$(($(/usr/bin/stat -f '%z' "${3}") - ${2}))
      head -c ${bytes} "${3}"
    ;;
    *)
      echo "Usage: ftrim [-b|-e] <bytes> <file>"
      echo "ftrim -h for more info"
      ;;
   esac
}

# Find short hand
f() {
  find . -name "${1}" 2>&1 | grep -v 'Permission denied'
}

# List all files, long format, colorized, permissions in octal
la(){
 	ls -l  "${@}" | awk '
    {
      k=0;
      for (i=0;i<=8;i++)
        k+=((substr($1,i+2,1)~/[rwx]/) *2^(8-i));
      if (k)
        printf("%0o ",k);
      printf(" %9s  %3s %2s %5s  %6s  %s %s %s\n", $3, $6, $7, $8, $5, $9,$10, $11);
    }'
}

# Copy w/ progress
cp_p () {
  rsync -WavP --human-readable --progress "${1}" "${2}"
}

# who is using the laptop's iSight camera?
camerausedby() {
	echo "Checking to see who is using the iSight cameraâ€¦ ðŸ“·"
	usedby=$(lsof | grep -w "AppleCamera\|USBVDC\|iSight" | awk '{printf $2"\n"}' | xargs ps)
	echo -e "Recent camera uses:\n${usedby}"
}

# Markdown previews
md() {
    pandoc "${1}" | lynx -stdin
}

ipls() {
  local action
  local output

  action="${1}"
  output=""

  if command -v ifconfig >/dev/null; then
    if [[ "${action}" != "-a" ]] && [[ "${action}" != "--all" ]]; then
        output="$(ifconfig | grep "inet" | grep -v "127.0.0.1" | grep -v "::1" | cut -d" "  -f2 | cut -d"%" -f1 | sort)"
    else 
      # list all interfaces
      ifconfig -a | sed -E 's/[[:space:]:].*//;/^$/d' | while read -r interface; do
        # get IP for each interface
        ifconfig "${interface}" | grep "inet" | cut -d" "  -f2 | cut -d"%" -f1 | while read -r ip; do
          if [ -n "${ip}" ]; then
            output="${output}${interface}: ${ip}\n"
          fi
        done
      done
   fi
  fi

  case "${action}" in 
    -4)
        echo "${output}" | grep -v "::"
        ;;
    -6)
        echo "${output}" | grep -v "\."
        ;;
    -h|--help)
        echo "usage: ipls [-4|-6|-a]"
        echo ""
        echo "options"
        echo "-4, -6        Show only IPv4 or IPv6 addresses"
        echo "-a, --all     Label all IPs with interface label"
        ;;
    *)
      echo "${output}"
  esac
}

xor() {
  printf '%#x\n' "$((${1} ^ ${2}))"
}
